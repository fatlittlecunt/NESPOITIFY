<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artist Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .artist-header {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .artist-picture img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ccc;
        }
        .artist-details h1 {
            margin: 0;
            font-size: 28px;
            color: #333;
        }
        .artist-details p {
            margin: 5px 0;
            color: #555;
        }
        .song-list {
            margin-top: 20px;
        }
        .song-list h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }
        .song-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .song-item div {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .song-item .title, 
        .song-item .duration, 
        .song-item .popularity {
            min-width: 200px;
        }
        .song-item .duration, 
        .song-item .popularity {
            font-size: 14px;
            color: #666;
        }
        .progress-container {
            width: 100%;
            height: 5px;
            background-color: #ddd;
            margin-top: 10px;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            width: 0;
            background-color: #4caf50;
            transition: width 0.1s;
        }
        .controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        .controls button {
            padding: 10px 20px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .controls button:disabled {
            background-color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="artist-header">
            <div class="artist-picture">
                <img id="artist-picture" src="" alt="Artist Picture">
            </div>
            <div class="artist-details">
                <h1 id="artist-name"></h1>
                <p><strong>Country:</strong> <span id="artist-country"></span></p>
                <p><strong>Genre:</strong> <span id="artist-genre"></span></p>
                <p id="artist-description"></p>
            </div>
        </div>

        <div class="song-list">
            <h2>Songs</h2>
            <div id="songs-container">
                <!-- Songs will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Progress Bar container is placed at the bottom of the page -->
    <div class="progress-container">
        <div id="progress-bar" class="progress-bar"></div>
    </div>
    <script src="is_manager.js"></script>
    <script src="play_audio.js"></script>


    <script>
        let audioPlayer;
        let isPlaying = false;
        let currentSongUrl = '';
        let currentProgressBar = null;
        let currentButton = null;  // Track the current play button
        let res = 0;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ–± –∞—Ä—Ç–∏—Å—Ç–µ –∏ –ø–µ—Å–Ω—è—Ö
        async function loadArtist(artistId) {
            try {


                
                const response = await fetch(`http://localhost:8080/artist/${artistId}`);
                const data = await response.json();

                // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞—Ä—Ç–∏—Å—Ç–µ
                document.getElementById('artist-name').textContent = data.artist.artist_name;
                document.getElementById('artist-country').textContent = data.artist.country;
                document.getElementById('artist-genre').textContent = data.artist.genre;
                document.getElementById('artist-description').textContent = data.artist.description;
                document.getElementById('artist-picture').src = data.artist.artist_picture;

                // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–µ—Å–µ–Ω
                const songsContainer = document.getElementById('songs-container');
                songsContainer.innerHTML = ''; // –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                const isManager = await is_manager();

        data.songs.forEach((song, index) => {
            const songItem = document.createElement('div');
            songItem.classList.add('song-item');
            songItem.innerHTML = `
                <div class="title">
                    <strong>${song.song_title}</strong>
                </div>
                <div class="duration">Duration: ${song.duration}s</div>
                <div class="popularity">Popularity: ${song.song_popularity}</div>
                <button class="play-button" data-audio="${song.song_url}" data-id="${song.song_id}">
                    ‚ñ∂ Play
                </button>
                <button class="like-button" data-id="${song.song_id}">
                    ‚ù§Ô∏è Like
                </button>
                <div class="progress-container">
                    <div class="progress-bar" data-index="${index}"></div>
                </div>
            `;

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä, –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–£–¥–∞–ª–∏—Ç—å –ø–µ—Å–Ω—é"
            if (isManager) {
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'üóë –£–¥–∞–ª–∏—Ç—å';
                deleteButton.classList.add('delete-song-button');
                deleteButton.dataset.id = song.song_id;

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è –ø–µ—Å–Ω–∏
                deleteButton.addEventListener('click', async () => {
                    const confirmDelete = confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø–µ—Å–Ω—é? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.');
                    if (confirmDelete) {
                        await deleteSong(song.song_id);
                    }
                });

                songItem.appendChild(deleteButton);
            }

            songsContainer.appendChild(songItem);
        });

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "Play"
                const playButtons = document.querySelectorAll('.play-button');
                playButtons.forEach(button => {
                    button.addEventListener('click', event => {
                        const audioUrl = event.target.dataset.audio;
                        const songID = event.target.dataset.id;
                        const progressBar = event.target.closest('.song-item').querySelector('.progress-bar');
                        playAudio(audioUrl, progressBar, event.target, songID);
                    });
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "Like"
                const likeButtons = document.querySelectorAll('.like-button');
                likeButtons.forEach(button => {
                    button.addEventListener('click', async (event) => {
                        const songId = event.target.dataset.id;
                        await likeSong(songId);
                    });
                });
            } catch (error) {
                console.error('Error loading artist data:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–∞–π–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        

        // –ü—Ä–∏–º–µ—Ä: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞—Ä—Ç–∏—Å—Ç–µ
        const urlParams = new URLSearchParams(window.location.search);
        const artistId = urlParams.get('artist_id');
        if (artistId) {
            loadArtist(artistId);
        } else {
            alert('Artist ID is missing in URL');
        }


        is_manager().then(isManager => {
            if (isManager) {
                const artistHeader = document.querySelector('.artist-details');

        // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫
        const buttonContainer = document.createElement('div');
        buttonContainer.style.display = 'flex';
        buttonContainer.style.gap = '10px';
        buttonContainer.style.marginTop = '10px';

        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
        const editButton = document.createElement('button');
        editButton.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
        editButton.dataset.id = artistId;
        editButton.style.padding = '10px';
        editButton.style.backgroundColor = '#4caf50';
        editButton.style.color = 'white';
        editButton.style.border = 'none';
        editButton.style.borderRadius = '5px';
        editButton.style.cursor = 'pointer';
        editButton.addEventListener('click', () => {
            // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            window.location.href = `edit-artist.html?artist_id=${artistId}`;
        });

        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É "–£–¥–∞–ª–∏—Ç—å"
        const deleteButton = document.createElement('button');
        deleteButton.textContent = '–£–¥–∞–ª–∏—Ç—å';
        deleteButton.dataset.id = artistId;
        deleteButton.style.padding = '10px';
        deleteButton.style.backgroundColor = '#f44336';
        deleteButton.style.color = 'white';
        deleteButton.style.border = 'none';
        deleteButton.style.borderRadius = '5px';
        deleteButton.style.cursor = 'pointer';
        deleteButton.addEventListener('click', async () => {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –≥—Ä—É–ø–ø—É?')) {
                await deleteArtist(artistId);
            }
        });

        // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω—é"
        const addSongButton = document.createElement('button');
        addSongButton.textContent = '–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω—é';
        addSongButton.dataset.id = artistId;
        addSongButton.style.padding = '10px';
        addSongButton.style.backgroundColor = '#2196f3';
        addSongButton.style.color = 'white';
        addSongButton.style.border = 'none';
        addSongButton.style.borderRadius = '5px';
        addSongButton.style.cursor = 'pointer';
        addSongButton.addEventListener('click', () => {
            // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Å–Ω–∏
            window.location.href = `add-song.html?artist_id=${artistId}`;
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        buttonContainer.appendChild(editButton);
        buttonContainer.appendChild(deleteButton);
        buttonContainer.appendChild(addSongButton);

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫ artistHeader
        artistHeader.appendChild(buttonContainer);
            }
        } 
        );

        async function deleteArtist(artistId) {
    // –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    const confirmDelete = confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –≥—Ä—É–ø–ø—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.');

    if (!confirmDelete) {
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–ù–µ—Ç", –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
        return;
    }

    try {
        const response = await fetch(`http://localhost:8080/delete_artist/${artistId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('jwt')}`
            }
        });

        if (response.ok) {
            alert('–ì—Ä—É–ø–ø–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.');
            window.location.href = 'artists.html'; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É –∞—Ä—Ç–∏—Å—Ç–æ–≤
        } else {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≥—Ä—É–ø–ø—ã.');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≥—Ä—É–ø–ø—ã:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
    }
}

async function deleteSong(SongID) {
    // –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    const confirmDelete = confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø–µ—Å–Ω—é? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.');

    if (!confirmDelete) {
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–ù–µ—Ç", –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
        return;
    }

    try {
        const response = await fetch(`http://localhost:8080/delete_song/${SongID}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('jwt')}`
            }
        });

        if (response.ok) {
            alert('–ü–µ—Å–Ω—è —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.');
            window.location.href = 'artists.html'; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É –∞—Ä—Ç–∏—Å—Ç–æ–≤
        } else {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–µ—Å–Ω–∏.');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–µ—Å–Ω–∏:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
    }
}
    </script>
</body>
</html>
